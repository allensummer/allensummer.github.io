<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>王谦的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="王谦的博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="王谦的博客">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="王谦的博客">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="王谦的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://img15.3lian.com/2015/f2/52/58.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">王谦</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						
						<li>About</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.git/allensummer" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/u/2520238585/home?wvr=5" title="weibo">weibo</a>
					        
								<a class="mail" target="_blank" href="/wang_qian010@163.com" title="mail">mail</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/ARIMA/" style="font-size: 10px;">ARIMA</a> <a href="/tags/ARMRA/" style="font-size: 10px;">ARMRA</a> <a href="/tags/R/" style="font-size: 10px;">R</a> <a href="/tags/时间序列/" style="font-size: 10px;">时间序列</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">一份努力一份成就</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">王谦</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://img15.3lian.com/2015/f2/52/58.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">王谦</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.git/allensummer" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/u/2520238585/home?wvr=5" title="weibo">weibo</a>
			        
						<a class="mail" target="_blank" href="/wang_qian010@163.com" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-test" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/29/test/" class="article-date">
  	<time datetime="2016-03-29T08:07:51.000Z" itemprop="datePublished">2016-03-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/29/test/">时间序列完全教程（R）</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>在商业应用中，时间是最重要的因素，能够提升成功率。然而绝大多数公司很难跟上时间的脚步。但是随着技术的发展，出现了很多有效的方法，能够让我们预测未来。不要担心，本文并不会讨论时间机器，讨论的都是很实用的东西。<br>本文将要讨论关于预测的方法。有一种预测是跟时间相关的，而这种处理与时间相关数据的方法叫做<strong>时间序列模型</strong>。这个模型能够在与时间相关的数据中，寻到一些隐藏的信息来辅助决策。<br>当我们处理时序序列数据的时候，时间序列模型是非常有用的模型。大多数公司都是基于时间序列数据来分析第二年的销售量，网站流量，竞争地位和更多的东西。然而很多人并不了解的时间序列分析这个领域。<br>所以，如果你不了解时间序列模型。这篇文章将会想你介绍时间序列模型的处理步骤以及它的相关技术。<br>本文包含的内容如下所示：<br>目录</p>
<ul>
<li>1、时间序列模型介绍</li>
<li>2、使用R语言来探索时间序列数据</li>
<li>3、介绍ARMA时间序列模型</li>
<li>4、ARIMA时间序列模型的框架与应用</li>
</ul>
<p>让我们开始吧</p>
<h1 id="1、时间序列模型介绍"><a href="#1、时间序列模型介绍" class="headerlink" title="1、时间序列模型介绍"></a>1、时间序列模型介绍</h1><p>Let’s begin。本节包括平稳序列，随机游走,Rho系数,Dickey Fuller检验平稳性。如果这些知识你都不知道，不用担心-接下来这些概念本节都会进行详细的介绍，我敢打赌你很喜欢我的介绍的。</p>
<h2 id="平稳序列"><a href="#平稳序列" class="headerlink" title="平稳序列"></a>平稳序列</h2><p>判断一个序列是不是平稳序列有三个评判标准：</p>
<ol>
<li><p>均值 ，是与时间t 无关的常数。下图（左）满足平稳序列的条件，下图（右）很明显具有时间依赖。<br><img src="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/02/Mean_nonstationary.png?w=586" alt=""></p>
</li>
<li><p>方差 ，是与时间t 无关的常数。这个特性叫做方差齐性。下图显示了什么是方差对齐，什么不是方差对齐。（注意右手边途中的不同分布。）<br><img src="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/02/Var_nonstationary.png?w=577" alt=""></p>
</li>
<li><p>协方差 ，只与时期间隔k有关，与时间t 无关的常数。如下图（右），可以注意到随着时间的增加，曲线变得越来越近。因此红色序列的协方差并不是恒定的。<br><img src="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/02/Cov_nonstationary.png?w=566" alt=""></p>
<h3 id="我们为什么要关心平稳时间序列呢？"><a href="#我们为什么要关心平稳时间序列呢？" class="headerlink" title="我们为什么要关心平稳时间序列呢？"></a>我们为什么要关心平稳时间序列呢？</h3><p>除非你的时间序列是平稳的，否则不能建立一个时间序列模型。在很多案例中时间平稳条件常常是不满足的，所以首先要做的就是让时间序列变得平稳，然后尝试使用随机模型预测这个时间序列。有很多方法来平稳数据，比如消除长期趋势，差分化。</p>
<h2 id="随机游走"><a href="#随机游走" class="headerlink" title="随机游走"></a>随机游走</h2><p>这是时间序列最基本的概念。你可能很了解这个概念。但是，很多工业界的人仍然将随机游走看做一个平稳序列。在这一节中，我会使用一些数学工具，帮助理解这个概念。我们先看一个例子<br><strong>例子</strong>：想想一个女孩随机的在想象一个女孩在一个巨型棋盘上面随意移动。这里，下一个位置只取决于上一个位置。<br><img src="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/02/RandomWalk.gif?resize=520%2C224" alt=""></p>
<center> (来源: <a href="http://scifun.chem.wisc.edu/WOP/RandomWalk.html" target="_blank" rel="external">http://scifun.chem.wisc.edu/WOP/RandomWalk.html</a> )</center>

</li>
</ol>
<p>现在想象一下，你在一个封闭的房间里，不能看见这个女孩。但是你想要预测不同时刻这个女孩的位置。怎么才能预测的准一点？当然随着时间的推移你预测的越来越不准。在t=0时刻，你肯定知道这个女孩在哪里。下一个时刻女孩移动到附件8块方格中的一块，这个时候，你预测到的可能性已经降为1/8。继续往下继续预测，现在我们将这个序列公式化：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$X(t) = X(t-1) + Er(t)$</span><br><span class="line">这里的$Er_t$代表这这个时间点随机干扰项。这个就是女孩在每一个时间点带来的随机性。</span><br></pre></td></tr></table></figure></p>
<p>现在我们递归所有x时间点，最后我们将得到下面的等式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$X(t) = X(0) + Sum(Er(1),Er(2),Er(3).....Er(t))$</span><br></pre></td></tr></table></figure></p>
<p>现在，让我们尝试验证一下随机游走的平稳性假设：</p>
<ol>
<li>是否均值为常数？<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E[X(t)] = E[X(0)] + Sum(E[Er(1)],E[Er(2)],E[Er(3)].....E[Er(t)])</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>我们知道由于随机过程的随机干扰项的期望值为0.到目前为止：E[X(t)] = E[X(0)] = 常数</p>
<ol>
<li>是否方差为常数？<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Var[X(t)] = Var[X(0)] + Sum(Var[Er(1)],Var[Er(2)],Var[Er(3)].....Var[Er(t)])</span><br><span class="line">Var[X(t)] = t * Var(Error) = 时间相关</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>因此，我们推断，随机游走不是一个平稳的过程，因为它有一个时变方差。此外，如果我们检查的协方差，我们看到协方差依赖于时间。</p>
<h3 id="我们看一个更有趣的东西"><a href="#我们看一个更有趣的东西" class="headerlink" title="我们看一个更有趣的东西"></a>我们看一个更有趣的东西</h3><p>我们已经知道一个随机游走是一个非平稳的过程。让我们在方程中引入一个新的系数，看看我们是否能制定一个检查平稳性的公式。<br><strong>Rho系数</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X(t) = Rho * X(t-1) + Er(t)</span><br></pre></td></tr></table></figure></p>
<p>现在，我们将改变Rho看看我们可不可以让这个序列变的平稳。这里我们只是看，并不进行平稳性检验。<br>让我们从一个Rho=0的完全平稳序列开始。这里是时间序列的图：<br><img src="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/02/rho0.png?w=939" alt=""><br>将Rho的值增加到0.5，我们将会得到如下图：<br><img src="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/02/rho5.png?w=941" alt=""><br>你可能会注意到，我们的周期变长了，但基本上似乎没有一个严重的违反平稳性假设。现在让我们采取更极端的情况下ρ= 0.9<br><img src="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/02/rho9.png?w=941" alt=""><br>我们仍然看到，在一定的时间间隔后，从极端值返回到零。这一系列也不违反非平稳性明显。现在，让我们用ρ= 1随机游走看看<br><img src="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/02/rho1.png" alt=""><br>这显然是违反固定条件。是什么使rho= 1变得这么特殊的呢？，这种情况并不满足平稳性测试？我们来找找这个数学的原因<br>公式X(t) = Rho * X(t-1) + Er(t)的期望为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E[X(t)] = Rho *E[ X(t-1)]</span><br></pre></td></tr></table></figure></p>
<p>这个公式很有意义。下一个X(或者时间点t)被拉到Rho*上一个x的值。<br>例如，如果x（t–1）= 1，E[X（T）] = 0.5（Rho= 0.5）。现在，如果从零移动到任何方向下一步想要期望为0。唯一可以让期望变得更大的就是错误率。当Rho变成1呢？下一步没有任何可能下降。</p>
<h2 id="Dickey-Fuller-Test平稳性"><a href="#Dickey-Fuller-Test平稳性" class="headerlink" title="Dickey Fuller Test平稳性"></a>Dickey Fuller Test平稳性</h2><p>这里学习的最后一个知识点是Dickey Fuller检验。。在统计学里，Dickey-Fuller检验是测试一个自回归模型是否存在单位根。这里根据上面Rho系数有一个调整，将公式转换为Dickey-Fuller检验<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X(t) = Rho * X(t-1) + Er(t)</span><br><span class="line">=&gt;  X(t) - X(t-1) = (Rho - 1) X(t - 1) + Er(t)</span><br></pre></td></tr></table></figure></p>
<p>我们要测试如果Rho–1=0是否差异显著。如果零假设不成立，我们将得到一个平稳时间序列。<br>平稳性测试和将一个序列转换为平稳性序列是时间序列模型中最重要的部分。因此需要记住本节提到的所有概念方便进入下一节。<br>接下来就看看时间序列的例子。</p>
<h1 id="2、使用R探索时间序列"><a href="#2、使用R探索时间序列" class="headerlink" title="2、使用R探索时间序列"></a>2、使用R探索时间序列</h1><p>本节我们将学习如何使用R处理时间序列。这里我们只是探索时间序列，并不会建立时间序列模型。<br>本节使用的数据是R中的内置数据：AirPassengers。这个数据集是1949-1960年每个月国际航空的乘客数量的数据。</p>
<h2 id="在入数据集"><a href="#在入数据集" class="headerlink" title="在入数据集"></a>在入数据集</h2><p>下面的代码将帮助我们在入数据集并且能够看到一些少量的数据集。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt; data(AirPassengers)<span class="comment">#在入数据</span></span><br><span class="line"> &gt; class(AirPassengers)</span><br><span class="line"> [<span class="number">1</span>] <span class="string">"ts"</span></span><br><span class="line"><span class="comment"># 查看AirPassengers数据类型，这里是时间序列数据</span></span><br><span class="line"> &gt; start(AirPassengers)</span><br><span class="line"> [<span class="number">1</span>] <span class="number">1949</span> <span class="number">1</span></span><br><span class="line"><span class="comment"># 这个是Airpassengers数据开始的时间</span></span><br><span class="line">&gt; end(AirPassengers)</span><br><span class="line"> [<span class="number">1</span>] <span class="number">1960</span> <span class="number">12</span></span><br><span class="line"><span class="comment">#这个是Airpassengers数据结束的时间</span></span><br><span class="line">&gt; frequency(AirPassengers)</span><br><span class="line"> [<span class="number">1</span>] <span class="number">12</span></span><br><span class="line"><span class="comment">#时间序列的频率是一年12个月</span></span><br><span class="line"> &gt; summary(AirPassengers)</span><br><span class="line"> Min. 1st Qu. Median Mean 3rd Qu. Max.</span><br><span class="line"> <span class="number">104.0</span> <span class="number">180.0</span> <span class="number">265.5</span> <span class="number">280.3</span> <span class="number">360.5</span> <span class="number">622.0</span></span><br></pre></td></tr></table></figure></p>
<h2 id="矩阵中详细数据"><a href="#矩阵中详细数据" class="headerlink" title="矩阵中详细数据"></a>矩阵中详细数据</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#The number of passengers are distributed across the spectrum</span></span><br><span class="line">&gt; plot(AirPassengers)</span><br><span class="line"><span class="comment">#绘制出时间序列</span></span><br><span class="line">&gt;abline(reg=lm(AirPassengers~time(AirPassengers)))</span><br><span class="line"><span class="comment"># 拟合一条直线</span></span><br></pre></td></tr></table></figure>
<p><img src="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/02/plot_AP1.png?resize=850%2C367" alt=""><br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt; cycle(AirPassengers)</span><br><span class="line">     Jan Feb Mar Apr May Jun Jul Aug Sep Oct  Nov Dec</span><br><span class="line"><span class="number">1949</span>   <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span>   <span class="number">8</span>   <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span>  <span class="number">12</span></span><br><span class="line"><span class="number">1950</span>   <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span>   <span class="number">8</span>   <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span>  <span class="number">12</span></span><br><span class="line"><span class="number">1951</span>   <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span>   <span class="number">8</span>   <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span>  <span class="number">12</span></span><br><span class="line"><span class="number">1952</span>   <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span>   <span class="number">8</span>   <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span>  <span class="number">12</span></span><br><span class="line"><span class="number">1953</span>   <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span>   <span class="number">8</span>   <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span>  <span class="number">12</span></span><br><span class="line"><span class="number">1954</span>   <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span>   <span class="number">8</span>   <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span>  <span class="number">12</span></span><br><span class="line"><span class="number">1955</span>   <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span>   <span class="number">8</span>   <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span>  <span class="number">12</span></span><br><span class="line"><span class="number">1956</span>   <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span>   <span class="number">8</span>   <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span>  <span class="number">12</span></span><br><span class="line"><span class="number">1957</span>   <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span>   <span class="number">8</span>   <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span>  <span class="number">12</span></span><br><span class="line"><span class="number">1958</span>   <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span>   <span class="number">8</span>   <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span>  <span class="number">12</span></span><br><span class="line"><span class="number">1959</span>   <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span>   <span class="number">8</span>   <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span>  <span class="number">12</span></span><br><span class="line"><span class="number">1960</span>   <span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span>   <span class="number">4</span>   <span class="number">5</span>   <span class="number">6</span>   <span class="number">7</span>   <span class="number">8</span>   <span class="number">9</span>  <span class="number">10</span>  <span class="number">11</span>  <span class="number">12</span></span><br><span class="line"><span class="comment"># 打印每年的周期</span></span><br><span class="line">&gt; plot(aggregate(AirPassengers,FUN=mean))</span><br><span class="line"><span class="comment">#绘制</span></span><br><span class="line">&gt; boxplot(AirPassengers~cycle(AirPassengers))</span><br><span class="line"><span class="comment">#绘制盒图</span></span><br></pre></td></tr></table></figure></p>
<p><img src="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/02/plot_aggregate.png?resize=850%2C342" alt=""></p>
<p><img src="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/02/plot_month_wise.png?resize=850%2C333" alt=""></p>
<h2 id="重要推论"><a href="#重要推论" class="headerlink" title="重要推论"></a>重要推论</h2><ol>
<li>每年的趋势显示旅客的数量每年都在增加</li>
<li>七八月的均值和方差比其他月份要高很多</li>
<li>每个月的平均值并不相同，但是方差差异很小。因此，可以看出具有很强的周期性。，一个周期为12个月或更少。</li>
</ol>
<p>查看数据，试探数据是建立时间序列模型最重要的一部-如果没有这一步，你将不知道这个序列是不是平稳序列。就像这个例子一样，我们已经知道了很多关于这个模型的很多细节。<br>接下来我们会建立一些时间序列模型以及这些模型的特征，也会最一些预测。</p>
<h1 id="3、ARMA时间序列模型"><a href="#3、ARMA时间序列模型" class="headerlink" title="3、ARMA时间序列模型"></a>3、ARMA时间序列模型</h1><p>ARMA也叫自回归移动平均混合模型。ARMA模型经常在时间序列中使用。在ARMA模型中，AR代表自回归，MA代表移动平均。如果这些术语听起来很复杂，不用担心-下面将会用几分钟的时间简单介绍这些概念。<br>我们现在就会领略这些模型的特点。在开始之前，你首先要记住，AR或者MA并不是应用在非平稳序列上的。<br>在实际应用中可能会得到一个非平稳序列，你首先要做的就是将这个序列变成平稳序列（通过差分化/转换），然后选择可以使用的时间序列模型。<br>首先，本文将介绍分开介绍两个模型（AR&amp;MA）。接下来我们看一看这些模型的特点。</p>
<h2 id="自回归时间序列模型"><a href="#自回归时间序列模型" class="headerlink" title="自回归时间序列模型"></a>自回归时间序列模型</h2><p>让我们从下面的例子理解AR模型：<br>现状一个国家的GDP（x(t)）依赖与去年的GDP（x(t-1)).这个假设一个国家今年的GDP总值依赖与去年的GDP总值和今年的新开的工厂和服务。但是GDP的主要依赖与去年去年的GDP。<br>那么，GDP的公式为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x(t) = alpha *  x(t – 1) + error (t)       （1）</span><br></pre></td></tr></table></figure></p>
<p>这个等式就是AR公式。公式（1）表示下一个点完全依赖与前面一个点。alpha是一个系数，希望能够找到alpha最小化错误率。x(t-1)同样依赖x(t)。<br>例如，x(t)代表一个城市在某一天的果汁的销售量。在冬天，极少的供应商进果汁。突然有一天，温度上升了，果汁的需求猛增到1000.然而过了几天，气温有下降了。但是众所周知，人们在热天会喝果汁，这些人会有50%在冷天仍然喝果汁。在接下来的几天，这个比例降到了25%(50%的50%），然后几天后逐渐降到一个很小的数。下图解释了AR序列的惯性：<br><img src="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/02/AR1.png?w=488" alt=""></p>
<h2 id="移动平均时间序列模型"><a href="#移动平均时间序列模型" class="headerlink" title="移动平均时间序列模型"></a>移动平均时间序列模型</h2><p>接下来另一个关于移动平均的例子。<br>一个公司生成某种类型的包，这个很容易理解。作为一个竞争的市场，包的销售量从零开始增加的。所以，有一天他做了一个实验，设计并制作了不同的包，这种包并不会被随时购买。因此，假设市场上总需求是1000个这种包。在某一天，这个包的需求特别高，很快库存快要完了。这天结束了还有100个包没卖掉。我们把这个误差成为时间点误差。接下来的几天仍有几个客户购买这种包。下面通过一个简单的公式来描述这个场景：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x(t) = beta *  error(t-1) + error (t)</span><br></pre></td></tr></table></figure></p>
<p>尝试把这个图画出来，就是这个样子的：<br><img src="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/02/MA1.png?w=488" alt=""><br>注意到MA和AR模型的不同了没？在MA模型中，噪声/冲击迅速小时。在AR模型中会受到长时间的影响。</p>
<h2 id="AR模型与MA模型的不同"><a href="#AR模型与MA模型的不同" class="headerlink" title="AR模型与MA模型的不同"></a>AR模型与MA模型的不同</h2><p>AR与MA模型的主要不同在于时间序列对象在不同时间点的相关性。<br>MA模型用过去各个时期的随机干扰或预测误差的线性组合来表达当前预测值。当n&gt;某一个值时，x(t)与x(t-n)的相关性总为0.AM模型仅通过时间序列变量的自身历史观测值来反映有关因素对预测目标的影响和作用，步骤模型变量相对独立的假设条件约束，所构成的模型可以消除普通回退预测方法中由于自变量选择、多重共线性等造成的困难。即AM模型中x(t)与x(t-1)的相关性随着时间的推移变得越来越小。这个差别要好好利用起来。</p>
<h2 id="利用ACF和PACF绘图"><a href="#利用ACF和PACF绘图" class="headerlink" title="利用ACF和PACF绘图"></a>利用ACF和PACF绘图</h2><p>一旦我们得到一个平稳时间序列。我们必须要回答两个最重要的问题；<br>Q1：这个是AR或者MA过程？<br>Q2：我们需要利用的AR或者MA过程的顺序是什么？</p>
<p>解决这两个问题我们要借助两个系数：<br>时间序列x(t)滞后k阶的样本自相关系数（ACF）和滞后k期的情况下样本偏自相关系数（PACF）。公式省略。<br>AR模型的ACF和PACF：<br>通过计算证明可知：</p>
<ul>
<li>AR的ACF为拖尾序列，即无论滞后期k取多大，ACF的计算值均与其1到p阶滞后的自相关函数有关。</li>
<li>AR的PACF为截尾序列，即当滞后期k&gt;p时PACF=0的现象。<br><img src="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/02/Gradual-decline.gif" alt=""><img src="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/02/cut-off.gif?resize=318%2C284" alt=""><br>上图蓝线显示值与0具有显著的差异。很显然上面PACF图显示截尾于第二个滞后，这意味这是一个AR（2）过程。<br>MA模型的ACF和PACF：</li>
<li>MA的ACF为截尾序列，即当滞后期k&gt;p时PACF=0的现象。</li>
<li>AR的PACF为拖尾序列，即无论滞后期k取多大，ACF的计算值均与其1到p阶滞后的自相关函数有关。<br><img src="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/02/cut-off.gif?resize=318%2C284" alt=""><img src="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/02/Gradual-decline.gif?resize=318%2C284" alt=""><br>很显然，上面ACF图截尾于第二个滞后，这以为这是一个MA（2）过程。<br>目前，本文已经介绍了关于使用ACF&amp;PACF图识别平稳序列的类型。现在，我将介绍一个时间序列模型的整体框架。此外，还将讨论时间序列模型的实际应用。</li>
</ul>
<h1 id="4、ARIMA时间序列模型的框架与应用"><a href="#4、ARIMA时间序列模型的框架与应用" class="headerlink" title="4、ARIMA时间序列模型的框架与应用"></a>4、ARIMA时间序列模型的框架与应用</h1><p>到此，本文快速介绍了时间序列模型的基础概念、使用R探索时间序列和ARMA模型。现在我们将这些零散的东西组织起来，做一件很有趣的事情。</p>
<h2 id="框架"><a href="#框架" class="headerlink" title="框架"></a>框架</h2><p>下图的框架展示了如何一步一步的“<strong>做一个时间序列分析</strong>”<br><img src="http://img.blog.csdn.net/20160322174807405" alt=""><br>前三步我们在前文意见讨论了。尽管如此，这里还是需要简单说明一下：</p>
<h3 id="第一步：时间序列可视化"><a href="#第一步：时间序列可视化" class="headerlink" title="第一步：时间序列可视化"></a>第一步：时间序列可视化</h3><p>在构建任何类型的时间序列模型之前，分析其趋势是至关重要的。我们感兴趣的细节包括序列中的各种趋势、周期\季节性或者随机行为。在本文的第二部分已经介绍了。</p>
<h3 id="第二步：序列平稳"><a href="#第二步：序列平稳" class="headerlink" title="第二步：序列平稳"></a>第二步：序列平稳</h3><p>一旦我们知道了模式、趋势、周期。我们就可以检查序列是否平稳。Dicky-Fuller是一种很流行的检验方式。在第一部分意见介绍了这种检验方式。在这里还没有结束！如果发现序列是非平稳序列怎么办？<br>这里有三种比较常用的技术来让一个时间序列平稳。<br>1 <strong>消除趋势</strong>：这里我们简单的删除时间序列中的趋势成分。例如，我的时间序列的方程是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x(t) = (mean + trend * t) + error</span><br></pre></td></tr></table></figure></p>
<p>这里我简单的删除上述公式中的trend<em>t部分，建立x(t)=mean+error模型<br>2 <em>*差分</em></em>：这个技术常常用来消除非平稳性。这里我们是对序列的差分的结果建立模型而不是真正的序列。例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x(t) – x(t-1) = ARMA (p ,  q)</span><br></pre></td></tr></table></figure></p>
<p>这个差分也是ARIMA的部分。现在我们有3个参数了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p:AR</span><br><span class="line">d:I</span><br><span class="line">q:MA</span><br></pre></td></tr></table></figure></p>
<p>3 <strong>季节性</strong>：季节性直接被纳入ARIMA模型中。下面的应用部分我们再讨论这个。</p>
<h3 id="第三步：找到最优参数"><a href="#第三步：找到最优参数" class="headerlink" title="第三步：找到最优参数"></a>第三步：找到最优参数</h3><p>参数p,q可以使用ACF和PACF图发现。除了这种方法，如果相关系数ACF和偏相关系数PACF逐渐减小，这表明我们需要进行时间序列平稳并引入d参数。</p>
<h3 id="第四步：简历ARIMA模型"><a href="#第四步：简历ARIMA模型" class="headerlink" title="第四步：简历ARIMA模型"></a>第四步：简历ARIMA模型</h3><p>找到了这些参数，我们现在就可以尝试简历ARIMA模型了。从上一步找到的值可能只是一个近似估计的值，我们需要探索更多(p,d,q）的组合。最小的BIC和AIC的模型参数才是我们要的。我们也可以尝试一些季节性成分。在这里，在ACF/PACF图中我们会注意到一些季节性的东西。</p>
<h3 id="第五步：预测"><a href="#第五步：预测" class="headerlink" title="第五步：预测"></a>第五步：预测</h3><p>到这步，我们就有了ARIMA模型，我们现在就可以做预测了。我们也可以将这种趋势可视化，进行交叉验证。</p>
<h2 id="时间序列模型的应用。"><a href="#时间序列模型的应用。" class="headerlink" title="时间序列模型的应用。"></a>时间序列模型的应用。</h2><p>这里我们用前面的例子。使用这个时间序列做预测。我们建议你在进行下一步之前，先观察这个数据。</p>
<h3 id="我们从哪里开始呢？"><a href="#我们从哪里开始呢？" class="headerlink" title="我们从哪里开始呢？"></a>我们从哪里开始呢？</h3><p>下图是这些年的乘客数的图。在往下看之前，观察这个图。<br><img src="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/02/plot_AP.png?resize=1024%2C467" alt=""><br>这里是我的观察：</p>
<ol>
<li>乘客有着逐年增加的趋势。</li>
<li>这看起来有季节性，每一个周期不超过12个月。</li>
<li>数据的方差逐年增加。<br>在我们进行平稳性测试之前我们需要解决两个问题。第一，我们需要消除方差不齐。这里我们对这个序列做求对数。第二我们需要解决序列的趋势性。我们通过对时序序列做差分。现在，我们来检验最终序列的平稳性。<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">adf.test(diff(log(AirPassengers)), alternative=<span class="string">"stationary"</span>, k=<span class="number">0</span>)</span><br><span class="line"><span class="comment"># 这里可能会显示没有这个函数，需要安装一下.install.packages("tseries")</span></span><br><span class="line"><span class="comment">#加在这个包,library(tseries</span></span><br><span class="line">	data: diff(log(AirPassengers))</span><br><span class="line"> 	Dickey-Fuller = -<span class="number">9.6003</span>, Lag order = <span class="number">0</span>,</span><br><span class="line"> 	p-value = <span class="number">0.01</span></span><br><span class="line"> 	alternative hypothesis: stationary</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>我们可以看出这个序列是足够平稳做任何时间序列模型。<br>下一步就是找到ARIMA模型的正确的参数。我们意见知道’d‘是1，因此我们需要做1差分让序列平稳。这里我们绘制出相关图。下面就是这个序列的ACF图。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ACF图</span><br><span class="line">acf(log(AirPassengers))</span><br></pre></td></tr></table></figure></p>
<p><img src="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/02/ACF_original.png?w=870" alt=""></p>
<h3 id="从上述表格可以看出什么？"><a href="#从上述表格可以看出什么？" class="headerlink" title="从上述表格可以看出什么？"></a>从上述表格可以看出什么？</h3><p>很显然ACF下降的十分的慢，这就意味着乘客的数量并不是平稳的。我们在前面已经讨论了，我们现状准备在序列去对数后的差分上做回归，而不是直接在序列去对数后的数据熵差分。让我们看一下差分后的ACF和PACF曲线吧。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; acf(diff(log(AirPassengers)))</span><br><span class="line">&gt; pacf(diff(log(AirPassengers)))</span><br></pre></td></tr></table></figure></p>
<p><img src="http://i2.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/02/ACF-diff.png?w=872" alt=""><img src="http://i1.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/02/PACF-diff.png?w=888" alt=""><br>显然ACF截止与第一个滞后，因此我们知道p的值应该是0.而q的值应该是1或者2.几次迭代以后，我们发现(p,d,q)取(0,1,1)时，AIC和BIC最小。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; fit &lt;- arima(log(AirPassengers), c(<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>),seasonal = list(order = c(<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>), period = <span class="number">12</span>))</span><br><span class="line">&gt; pred &lt;- predict(fit, n.ahead = <span class="number">10</span>*<span class="number">12</span>)</span><br><span class="line">ts.plot(AirPassengers,<span class="number">2.718</span>^pred$pred, log = <span class="string">"y"</span>, lty = c(<span class="number">1</span>,<span class="number">3</span>))</span><br></pre></td></tr></table></figure></p>
<p><img src="http://i0.wp.com/www.analyticsvidhya.com/wp-content/uploads/2015/02/predictions.png?w=869" alt=""></p>
<h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>我参加一个时间序列的比赛，对时间序列的了解止步与马尔科夫模型。而且马尔科夫模型并不适合解纯时间序列的问题，所以就上网搜索一下时间序列的相关知识。很偶然的发现了这篇文章，文章的逻辑清晰，表达清楚，文字浅显易懂，值得我学习，所以我就尝试翻译了这篇文章。中间很多东西并不是很了解，如有错误的地方，欢迎指正。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="http://www.analyticsvidhya.com/blog/2015/12/complete-tutorial-time-series-modeling/" target="_blank" rel="external">A Complete Tutorial on Time Series Modeling in R</a><br><a href="http://wenku.baidu.com/link?url=b34APzBjz-cGLoxsG4-nvbwKy7FLgPk5n4nzC9w-pWQP7pc4MycpyQZil4Oe5I0285cMGz1WX79Q4aExF8Ft-n0okdqgNs4DhkRsSIWZ2zq" target="_blank" rel="external">时间序列</a><br><a href="wwwd.docin.com/p-682510490.html">第八章时间序列分析</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ARIMA/">ARIMA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ARMRA/">ARMRA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/R/">R</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/时间序列/">时间序列</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/29/hello-world/" class="article-date">
  	<time datetime="2016-03-29T06:55:09.842Z" itemprop="datePublished">2016-03-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/29/hello-world/">Hello World</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 王谦
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>